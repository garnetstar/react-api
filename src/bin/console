#!/usr/bin/env php
<?php

// application.php


use Command\IndexationCommand;
use Elasticsearch\Client;
use Elasticsearch\ClientBuilder;
use Nette\Database\Connection;
use Pimple\Container;
use Symfony\Component\Console\Application;

require __DIR__ . '/../vendor/autoload.php';

$container = new Container();

$container['database'] = function($c) {
	$database = new Connection('mysql:host=db;dbname=' . getenv('DB_NAME'), 'root', getenv('DB_PASSWORD'));
	return $database;
};

$container[Client::class] = function($c) {
	$hosts = [
	'elastic1:9200', // IP + Port
	];
	$clientBuilder = ClientBuilder::create();   // Instantiate a new ClientBuilder
	$clientBuilder->setHosts($hosts);		   // Set the hosts
	$client = $clientBuilder->build();
	return $client;
};

$container[IndexationCommand::class] = function($c) {
	return new IndexationCommand($c[Client::class],$c['database']);
};

$application = new Application();

$application->add($container[IndexationCommand::class]);

$application->run();

function dump($var)
{
	echo '<pre>' . print_r($var, true) . '</pre>';
}
